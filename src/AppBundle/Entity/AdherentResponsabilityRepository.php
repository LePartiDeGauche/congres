<?php

namespace AppBundle\Entity;

use Doctrine\ORM\EntityRepository;
use Symfony\Component\Validator\Constraints\DateTime;

/**
 * ContributionRepository.
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class AdherentResponsabilityRepository extends EntityRepository
{
    protected $classname;

    public function findOldResponsabilityByAdherentAndResponsability(Adherent $adherent, \DateTime $currentDate, Responsability $responsability)
    {
//        $adherentResponsability = $this->createQueryBuilder('a')
//            ->select('a')
//            ->where('a.adherent = :adherent')
//            //->andWhere('a.start > :currentDate')
//            ->andWhere('a.responsability = :responsability')
//            ->setParameter('adherent', $adherent)
//           ->setParameter('currentDate', $currentDate)
//            ->setParameter('responsability', $responsability)
//            ->getQuery();
//
//        return $adherentResponsability->getFirstResult();

        return $adherentResponsability = $this
            ->createQueryBuilder('ar')
            ->select('ar')
            ->where('ar.adherent = :adherent')
            ->andWhere('ar.start < :currentDate')
            ->andWhere('ar.responsability = :responsability')
            ->setParameter('adherent', $adherent)
            ->setParameter('currentDate', $currentDate)
            ->setParameter('responsability', $responsability)
            ->getQuery()
            ->getResult()
        ;

        //return $adherentResponsability = $query->getResult();

    }
}
